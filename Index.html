<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional HTML to PDF Converter</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f4f6f9;
            --preview-bg: #ffffff;
            --preview-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding-bottom: 50px;
        }

        /* Header Styling */
        .navbar-brand {
            font-weight: 700;
            color: #fff !important;
        }
        .navbar {
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Editor Section */
        .editor-card {
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        textarea#html-input {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            background-color: #2d2d2d;
            color: #f8f9fa;
            border: 1px solid #444;
            resize: vertical;
        }

        /* Preview Section */
        #preview-wrapper {
            background-color: #525659; /* Dark background like Adobe Reader */
            padding: 30px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 800px;
            text-align: center;
        }

        #preview {
            background-color: var(--preview-bg);
            color: #000;
            width: 100%;
            max-width: 210mm; /* Approx A4 width */
            min-height: 297mm; /* Approx A4 height */
            margin: 0 auto;
            padding: 20px; /* Simulate page margin visually */
            box-shadow: var(--preview-shadow);
            text-align: left;
            overflow: hidden; /* Ensure content stays inside */
        }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fa-solid fa-file-pdf me-2"></i> HTML to PDF Converter
            </a>
            <span class="navbar-text text-light d-none d-md-block">
                Client-side Secure Conversion
            </span>
        </div>
    </nav>

    <div class="container">
        
        <!-- Controls & Configuration -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card editor-card p-3">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="filename" class="form-label fw-bold">Filename</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="filename" value="document" placeholder="filename">
                                <span class="input-group-text">.pdf</span>
                            </div>
                        </div>
                        <div class="col-md-2 col-6">
                            <label for="pageSize" class="form-label fw-bold">Page Size</label>
                            <select class="form-select" id="pageSize">
                                <option value="a4" selected>A4</option>
                                <option value="letter">Letter</option>
                                <option value="legal">Legal</option>
                            </select>
                        </div>
                        <div class="col-md-2 col-6">
                            <label for="orientation" class="form-label fw-bold">Orientation</label>
                            <select class="form-select" id="orientation">
                                <option value="portrait" selected>Portrait</option>
                                <option value="landscape">Landscape</option>
                            </select>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <!-- Helper text or space -->
                            <small class="text-muted">Configure before downloading</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column: Input -->
            <div class="col-lg-6 mb-4">
                <div class="card editor-card h-100">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-primary"><i class="fa-solid fa-code me-2"></i>HTML Input</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="loadSample()">Load Sample</button>
                    </div>
                    <div class="card-body p-0">
                        <textarea class="form-control h-100 border-0 rounded-0 p-3" id="html-input" rows="20" placeholder="Paste your HTML here..."></textarea>
                    </div>
                    <div class="card-footer bg-white text-end">
                        <button class="btn btn-primary" onclick="updatePreview()">
                            <i class="fa-solid fa-eye me-2"></i>Render Preview
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Preview -->
            <div class="col-lg-6 mb-4">
                <div class="card editor-card h-100">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-success"><i class="fa-solid fa-print me-2"></i>Live Preview</h5>
                        <button class="btn btn-success" id="btn-download" disabled onclick="generatePDF()">
                            <i class="fa-solid fa-download me-2"></i>Download PDF
                        </button>
                    </div>
                    <div class="card-body p-0" id="preview-wrapper">
                        <!-- Content rendered here -->
                        <div id="preview"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner Overlay -->
    <div id="loading-overlay">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h4 class="mt-3 text-dark">Generating PDF...</h4>
        <p class="text-muted">This may take a few seconds for large content.</p>
    </div>

    <!-- Scripts -->
    <!-- DOMPurify for HTML Sanitization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <!-- html2pdf.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script>
        // Default Sample HTML
        const sampleHTML = `
<div style="font-family: sans-serif; color: #333;">
    <h1 style="color: #0d6efd; border-bottom: 2px solid #0d6efd; padding-bottom: 10px;">Invoice #12345</h1>
    <p><strong>Date:</strong> October 24, 2023</p>
    
    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <div>
            <h4>Bill To:</h4>
            <p>John Doe<br>123 Web Dev Lane<br>Internet City, 90210</p>
        </div>
        <div>
            <h4>From:</h4>
            <p>Tech Solutions Inc.<br>456 Server Road<br>Cloud Valley, 10101</p>
        </div>
    </div>

    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="background-color: #f2f2f2;">
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Item</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Qty</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Price</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Web Development Services</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">10</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$50.00</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$500.00</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;">Server Maintenance</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">2</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$100.00</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">$200.00</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">Grand Total</td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: right; font-weight: bold;">$700.00</td>
            </tr>
        </tfoot>
    </table>

    <div style="margin-top: 30px; padding: 15px; background-color: #e9ecef; border-radius: 5px;">
        <p style="margin: 0; font-size: 0.9em;">Thank you for your business. Please make payment within 30 days.</p>
    </div>
</div>
`;

        // Load sample on init
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('html-input').value = sampleHTML;
            updatePreview();
        });

        function loadSample() {
            if(confirm("This will replace current content. Continue?")) {
                document.getElementById('html-input').value = sampleHTML;
                updatePreview();
            }
        }

        /**
         * Sanitizes Input and Renders Preview
         * Uses DOMPurify to prevent XSS while keeping styles
         */
        function updatePreview() {
            const rawHtml = document.getElementById('html-input').value;
            const previewDiv = document.getElementById('preview');
            const downloadBtn = document.getElementById('btn-download');

            if (!rawHtml.trim()) {
                previewDiv.innerHTML = '<p class="text-muted text-center pt-5">Preview area is empty...</p>';
                downloadBtn.disabled = true;
                return;
            }

            // Configure DOMPurify to allow style tags and specific attributes for rich formatting
            const cleanHtml = DOMPurify.sanitize(rawHtml, {
                ADD_TAGS: ['style'], 
                ADD_ATTR: ['style', 'class', 'id', 'width', 'height', 'align', 'border', 'cellpadding', 'cellspacing']
            });

            previewDiv.innerHTML = cleanHtml;
            downloadBtn.disabled = false;
        }

        /**
         * Generates PDF using html2pdf.js
         */
        function generatePDF() {
            // UI Elements
            const element = document.getElementById('preview');
            const overlay = document.getElementById('loading-overlay');
            const filenameInput = document.getElementById('filename').value || 'document';
            
            // Config Inputs
            const pageSize = document.getElementById('pageSize').value;
            const orientation = document.getElementById('orientation').value;

            // Show Loading
            overlay.style.display = 'flex';

            // HTML2PDF Options
            const opt = {
                margin:       10, // mm
                filename:     `${filenameInput}.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: 2, // Higher scale = better resolution
                    useCORS: true, // Attempt to load images from other domains
                    logging: false 
                },
                jsPDF:        { 
                    unit: 'mm', 
                    format: pageSize, 
                    orientation: orientation 
                },
                // Page break settings to avoid cutting text/images in half
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Execution
            html2pdf().set(opt).from(element).save()
                .then(() => {
                    // Success callback
                    overlay.style.display = 'none';
                })
                .catch(err => {
                    // Error callback
                    console.error(err);
                    alert("Error generating PDF: " + err.message);
                    overlay.style.display = 'none';
                });
        }
    </script>
</body>
</html>
